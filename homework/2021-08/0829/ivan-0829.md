# Raft5.5-7

### 5.5 跟随者和候选人崩溃

无限重试

### 5.6 时间和可用性

时间要求：

广播时间（broadcastTime） << 选举超时时间（electionTimeout） << 平均故障间隔时间（MTBF）

## 6 集群成员变化

### 集群配置转换

在集群配置的转换过程中，可能存在划分成两个独立的大多数群体的可能性。

解决：配置更改必须两阶段。第一阶段中，新老配置要达成共同一致。

领导人在接收到配置更改请求后，配置会存在一个过渡状态“Cold,new”，直到Cnew被提交

![](https://github.com/maemual/raft-zh_cn/raw/master/images/raft-%E5%9B%BE11.png)

图中，虚线表示创建未提交，实现表示被提交。

### 新服务器加入

新加入的服务器由于没有存储任何日志条目，且拥有投票权，会导致此时不能提交新的日志条目，即一种可用性的时间间隔。

解决：提供额外的阶段，新的服务器在追赶上日志之前，没有投票权。

### 领导人不是新配置的一员

没懂

### 移除不在Cnew中的服务器可能会扰乱集群



## 7 日志压缩

快照：在某个时间点，整个系统的状态写入稳定的持久化存储，然后丢弃之前的日志。

![](https://github.com/maemual/raft-zh_cn/raw/master/images/raft-%E5%9B%BE12.png)

服务器一般独立创建快照，除了落后的跟随者。

领导者发送安装快照RPC给跟随者





















