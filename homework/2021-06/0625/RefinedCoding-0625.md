# ZooKeeper

## 3 ZooKeeper应用
- 显示每个应用的动机primitive

### 3.1 获取服务
- 几个主进程，给获取者提供配置
- 从主进程的失败中恢复，decoupling客户端
- 直从ZooKeeper中读取它们的状态
- 使用ZooKeeper选取主进程
- 每个节点在短时间内回应数次操作

### 3.2 分布式索引
- 索引工作分片
- 其他节点随时能够接管

### 3.3 雅虎消息队列
- 主备模式，无共享分布式架构
- 支持主题，或者配置元数据
- 处理失败检测，和成员管理
- 每个Broker域创建一个临时节点，用于成员管理

## 4 ZooKeeper实现
- 复制ZooKeeper数据，来Compose服务
- 图4，概要模块，每个节点最终提交到数据库
- 内存数据库，先写入日志，然后更新数据库
- 重现日志来提交操作，然后周期性生成快照
- 每个客户端只连接一个服务器节点
- 一致协议写入操作会被转发到主节点

### 4.1 处理请求
- 从不diverge
- 和客户端请求不同，事务符合幂等性
- 有条件的setDaat操作，setDataTXN为回应？

### 4.2 原子性广播
- Zab协议，法定人数的多数
- 高throughtput
- Zab保证旧的修改会从旧主节点传输到新主节点，然后广播
- TCP网络保证传输顺序
- 跟踪日志proposal，无需写入两次
- Zab如何保证消息只传输一次

### 4.3 复制数据库
- 每个副本一份拷贝

### 4.4 服务器客户端交互

