## 设计秒杀系统
- https://www.cnblogs.com/54chensongxia/p/13609148.html
- https://gongfukangee.github.io/2019/06/09/SecondsKill/
- https://www.infoq.cn/article/ypqschsrdsk8bv5nhny4
- https://segmentfault.com/a/1190000020970562

## 架构设计
- client --->  Application Server -----> Database
-          \--- CDN (Product Page)   \----- Cache (Stock Info)

## 模块设计
- 数据拆分：用户数据，推荐信息，时间信息，通过不同的服务获取
- 动静分离：商品页面提前生成，推送到CDN
- 数据整合：页面的数据更新，采用异步调用

## 接口限流
- 库存只有100件，但是有10000个用户请求
- 前端限流：点击按钮后的5绵中，禁用按钮
- 后端限流：使用Redis的数据过期策略
- 用户没有访问过，则插入标记，并设置过期失效时间
- 如果标记已存在，则湖绿请求
- 限制流量：TODO，令牌桶算法，漏铜算法

## 秒杀流程
- 查询库存，不够则不能购买
- 扣减库存，并生成订单
- 用户支付
- 长时间未支付，则回收库存
- 拿到库存，发送消息到队列，异步创建订单

## 库存系统
- 使用乐观锁处理高并发
- 对每行数据增加版本号，而不是加锁
- 每次减一，保存时检查版本号是否一致
- 一致则保存成功，否则重试
- TODO: 如何缓存库存信息

## 回收库存
- 定时任务，每15分钟扫描，数据库订单表
- 延迟队列，队列消费者处理，TOOD：如何设计延迟队列

